<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>슬라이더 캘린더</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f9f9f9;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        #calendar-carousel {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .nav-btn {
            background: none;
            border: 2px solid #ccc;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            color: #888;
            margin: 0 20px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background-color: #eee;
            border-color: #aaa;
        }

        #calendar-viewport {
            width: 400px;
            overflow: hidden;
        }

        #calendar-strip {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }

        .month-grid {
            flex: 0 0 400px; /* Do not grow, do not shrink, base width 400px */
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: #fff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: opacity 0.5s ease, transform 0.5s ease;
            opacity: 1;
            transform: scale(1.0);
        }
        
        .month-grid.side {
            opacity: 0.4;
            transform: scale(0.85);
        }

        .days-of-week, .dates-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            gap: 5px;
        }

        .days-of-week div { font-weight: bold; padding-bottom: 10px; }

        .date-cell {
            padding: 10px 5px;
            border-radius: 4px;
            transition: background-color 0.3s;
            min-height: 30px;
            font-size: 0.9em;
        }

        .date-cell.has-event { background-color: #eaf6ff; cursor: pointer; font-weight: bold; }
        .date-cell.has-event:hover { background-color: #d0eaff; }
        .date-cell .event-title { display: none; } /* Hide event titles in this view */
        .today { background-color: #fffbe6; border: 1px solid #ffeeba; }

        /* Modal Styles (mostly unchanged) */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background-color: white; padding: 30px; border-radius: 8px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; position: relative; }
        .close-btn { position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; z-index: 10; }
        .hidden { display: none; }
        .modal-header { display: flex; align-items: center; margin-bottom: 15px; gap: 15px; }
        .modal-header h2 { margin: 0; flex-grow: 1; text-align: center; }
        #back-to-list-btn { background: #eee; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 14px; }
        #back-to-list-btn:hover { background: #ddd; }
        #posts-list { list-style: none; padding: 0; }
        #posts-list li { padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; transition: background-color 0.2s; }
        #posts-list li:hover { background-color: #f4f4f4; }
        #content-body { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>My Calendar</h1>

    <div id="calendar-carousel">
        <button id="prev-month-btn" class="nav-btn">&lt;</button>
        <div id="calendar-viewport">
            <div id="calendar-strip"></div>
        </div>
        <button id="next-month-btn" class="nav-btn">&gt;</button>
    </div>

    <!-- Modals -->
    <div id="posts-modal" class="modal-overlay hidden">...</div>
    <div id="content-modal" class="modal-overlay hidden">...</div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const calendarStrip = document.getElementById('calendar-strip');
            const prevBtn = document.getElementById('prev-month-btn');
            const nextBtn = document.getElementById('next-month-btn');

            let allEvents = {};
            let availableMonths = []; // e.g., [{year: 2025, month: 7}, {year: 2025, month: 8}]
            let centerIndex = 0;
            let monthElements = [];

            async function initCalendar() {
                try {
                    const response = await fetch('data.json');
                    const data = await response.json();
                    const { validEvents } = processEvents(data);
                    allEvents = validEvents;

                    const today = new Date('2025-08-26T00:00:00');
                    const currentYear = today.getFullYear();
                    const startMonth = today.getMonth();

                    for (let month = startMonth; month <= 11; month++) {
                        availableMonths.push({ year: currentYear, month: month });
                    }

                    renderInitialView();
                    setupEventListeners();
                } catch (error) {
                    console.error("Failed to load calendar:", error);
                    document.getElementById('calendar-carousel').innerHTML = '<p>캘린더를 불러오는 데 실패했습니다.</p>';
                }
            }

            function renderInitialView() {
                // Create all month elements once
                monthElements = availableMonths.map(m => createMonthGrid(m.year, m.month, allEvents));
                
                // Special initial layout: last, current, next
                const lastMonthIndex = monthElements.length - 1;
                const currentMonthIndex = 0;
                const nextMonthIndex = 1;

                const initialOrder = [monthElements[lastMonthIndex], monthElements[currentMonthIndex], monthElements[nextMonthIndex]];
                
                calendarStrip.innerHTML = ''; // Clear strip
                initialOrder.forEach(el => calendarStrip.appendChild(el.cloneNode(true)));

                // Add classes to the visible clones
                calendarStrip.children[0].classList.add('side');
                calendarStrip.children[2].classList.add('side');
            }

            function updateView(direction) {
                if (direction === 'next') {
                    centerIndex = (centerIndex + 1) % availableMonths.length;
                } else if (direction === 'prev') {
                    centerIndex = (centerIndex - 1 + availableMonths.length) % availableMonths.length;
                }

                const prevIndex = (centerIndex - 1 + availableMonths.length) % availableMonths.length;
                const nextIndex = (centerIndex + 1) % availableMonths.length;

                const newOrder = [monthElements[prevIndex], monthElements[centerIndex], monthElements[nextIndex]];
                
                calendarStrip.innerHTML = '';
                newOrder.forEach(el => calendarStrip.appendChild(el.cloneNode(true)));

                calendarStrip.children[0].classList.add('side');
                calendarStrip.children[2].classList.add('side');
            }

            function setupEventListeners() {
                nextBtn.addEventListener('click', () => updateView('next'));
                prevBtn.addEventListener('click', () => updateView('prev'));
                // Modal-related event listeners need to be attached to a static parent
                document.body.addEventListener('click', (e) => {
                    const targetCell = e.target.closest('.date-cell.has-event');
                    if (targetCell) {
                        openPostsModal(targetCell.dataset.date);
                    }
                });
            }

            // The rest of your modal and utility functions (createMonthGrid, processEvents, etc.)
            // would go here. They are mostly the same but I will include them for completeness.
            // NOTE: I've simplified createMonthGrid slightly for this view.

            function createMonthGrid(year, month, events) {
                const monthGrid = document.createElement('div');
                monthGrid.className = 'month-grid';
                const monthName = new Date(year, month).toLocaleString('ko-KR', { month: 'long' });
                monthGrid.innerHTML = `<h2>${year}년 ${monthName}</h2>`;
                const daysOfWeek = document.createElement('div');
                daysOfWeek.className = 'days-of-week';
                ['일', '월', '화', '수', '목', '금', '토'].forEach(day => { daysOfWeek.innerHTML += `<div>${day}</div>`; });
                monthGrid.appendChild(daysOfWeek);
                const datesGrid = document.createElement('div');
                datesGrid.className = 'dates-grid';
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                for (let i = 0; i < firstDay; i++) { datesGrid.innerHTML += `<div class="date-cell"></div>`; }
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateCell = document.createElement('div');
                    dateCell.className = 'date-cell';
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    dateCell.textContent = day;
                    if (events[dateStr]) {
                        dateCell.classList.add('has-event');
                        dateCell.dataset.date = dateStr;
                    }
                    if (new Date(dateStr).toDateString() === new Date('2025-08-26').toDateString()) {
                        dateCell.classList.add('today');
                    }
                    datesGrid.appendChild(dateCell);
                }
                monthGrid.appendChild(datesGrid);
                return monthGrid;
            }
            
            // Dummy modal functions and processEvents to keep it runnable
            function processEvents(data) { /* ... same as before ... */ return { validEvents: data }; }
            function openPostsModal(date) { alert(`Events for ${date}`); }

            initCalendar();
        });
    </script>
</body>
</html>